{"componentChunkName":"component---src-templates-post-index-tsx","path":"/posts/docker-compose-gcc-error","result":{"data":{"mdx":{"body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Docker compose与gcc内存不足的错误\",\n  \"date\": \"2019-01-05T08:40:43.000Z\",\n  \"tags\": [\"docker\", \"gcc\", \"centOS\", \"linux\", \"python\", \"lxml\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"\\u89E3\\u51B3docker-compose\\u65F6pip intall lxml\\u53D1\\u751Fgcc\\u5185\\u5B58\\u4E0D\\u8DB3\\u7684\\u9519\\u8BEF\\u3002\"), mdx(\"p\", null, \"\\u8BB0\\u5FC6\\u4E2Dpython\\u7684\", mdx(\"code\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"language-text\"\n  }), \"lxml\"), \"\\u5E93\\u5B89\\u88C5\\u597D\\u50CF\\u4E00\\u76F4\\u4E0D\\u662F\\u5F88\\u987A\\u5229\\uFF0C\\u6BCF\\u6B21\\u73AF\\u5883\\u53D8\\u66F4\\u90FD\\u8981\\u6298\\u817E\\u4E0D\\u5C11\\u65F6\\u95F4\\u3002\\u8FD9\\u6B21\\u53C8\\u518D\\u6B21\\u9047\\u5230\\u4E86\\u76F8\\u4F3C\\u7684\\u95EE\\u9898\\u3002\"), mdx(\"p\", null, \"\\u7ECF\\u8FC7\\u672C\\u5730\", mdx(\"code\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"language-text\"\n  }), \"docker-compose up\"), \"\\u6D4B\\u8BD5\\u540E\\u6CA1\\u6709\\u95EE\\u9898\\u4F46\\u662F\\u670D\\u52A1\\u5668pull\\u4EE3\\u7801\\u8FD0\\u884C\\u65F6\\u5374\\u51FA\\u73B0\\u4E86\\u95EE\\u9898\\u3002\"), mdx(\"h2\", null, \"\\u73AF\\u5883\"), mdx(\"h3\", null, \"server\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"server OS\"), \" : Docker centOS7 Application\"), mdx(\"h4\", null, \"spec\"), mdx(\"table\", null, mdx(\"thead\", {\n    parentName: \"table\"\n  }, mdx(\"tr\", {\n    parentName: \"thead\"\n  }, mdx(\"th\", _extends({\n    parentName: \"tr\"\n  }, {\n    \"align\": null\n  }), \"-\"), mdx(\"th\", _extends({\n    parentName: \"tr\"\n  }, {\n    \"align\": null\n  }), \"-\"))), mdx(\"tbody\", {\n    parentName: \"table\"\n  }, mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", _extends({\n    parentName: \"tr\"\n  }, {\n    \"align\": null\n  }), \"CPU:\"), mdx(\"td\", _extends({\n    parentName: \"tr\"\n  }, {\n    \"align\": null\n  }), \"1 vCore\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", _extends({\n    parentName: \"tr\"\n  }, {\n    \"align\": null\n  }), \"RAM:\"), mdx(\"td\", _extends({\n    parentName: \"tr\"\n  }, {\n    \"align\": null\n  }), \"1024 MB\")), mdx(\"tr\", {\n    parentName: \"tbody\"\n  }, mdx(\"td\", _extends({\n    parentName: \"tr\"\n  }, {\n    \"align\": null\n  }), \"Storage:\"), mdx(\"td\", _extends({\n    parentName: \"tr\"\n  }, {\n    \"align\": null\n  }), \"25 GB SSD\")))), mdx(\"p\", null, \"\\u6700\\u521D\\u53EA\\u662F\\u505A\", mdx(\"code\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"language-text\"\n  }), \"proxy\"), \"\\u7528\\u7684\\u6240\\u4EE5\\u9009\\u4E86\\u5C3D\\u53EF\\u80FD\\u5C0F\\u7684\\uFF0C\\u4F46\\u662FRAM\\u5982\\u679C1G\\u4EE5\\u4E0Bdocker\\u90FD\\u5403\\u529B\\u6240\\u4EE5\\u59D1\\u4E14\\u9009\\u4E861G\\uFF0C\\u6CA1\\u60F3\\u5230\\u8FD8\\u662F\\u7A0D\\u5FAE\\u9047\\u5230\\u4E86\\u95EE\\u9898\"), mdx(\"h3\", null, \"requirements.txt\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"text\"\n  }, mdx(\"pre\", _extends({\n    parentName: \"div\"\n  }, {\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-text line-numbers\"\n  }), mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-text\"\n  }), \"# requirements.txt\\n\\nsanic\\nsanic-cors\\nrequests\\nlxml\"), mdx(\"span\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"h3\", null, \"Dockerfile\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"dockerfile\"\n  }, mdx(\"pre\", _extends({\n    parentName: \"div\"\n  }, {\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-dockerfile line-numbers\"\n  }), mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-dockerfile\"\n  }), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token comment\"\n  }), \"# Dockerfile\"), \"\\n\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token keyword\"\n  }), \"FROM\"), \" python\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token punctuation\"\n  }), \":\"), \"3.7\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token punctuation\"\n  }), \"-\"), \"alpine\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token keyword\"\n  }), \"ADD\"), \" . /app\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token keyword\"\n  }), \"WORKDIR\"), \" /app\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token keyword\"\n  }), \"RUN\"), \" apk add \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token punctuation\"\n  }), \"-\"), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token punctuation\"\n  }), \"-\"), \"no\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token punctuation\"\n  }), \"-\"), \"cache \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token punctuation\"\n  }), \"-\"), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token punctuation\"\n  }), \"-\"), \"virtual .build\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token punctuation\"\n  }), \"-\"), \"deps \\\\\\n    ca\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token punctuation\"\n  }), \"-\"), \"certificates make gcc postgresql\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token punctuation\"\n  }), \"-\"), \"dev linux\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token punctuation\"\n  }), \"-\"), \"headers musl\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token punctuation\"\n  }), \"-\"), \"dev libxslt\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token punctuation\"\n  }), \"-\"), \"dev\\\\\\n    libffi\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token punctuation\"\n  }), \"-\"), \"dev jpeg\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token punctuation\"\n  }), \"-\"), \"dev zlib\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token punctuation\"\n  }), \"-\"), \"dev \\\\\\n    && pip install \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token punctuation\"\n  }), \"-\"), \"r requirements.txt\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token keyword\"\n  }), \"CMD\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token punctuation\"\n  }), \"[\"), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token string\"\n  }), \"\\\"python\\\"\"), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token punctuation\"\n  }), \",\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token string\"\n  }), \"\\\"main.py\\\"\"), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token punctuation\"\n  }), \"]\"), \"\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token keyword\"\n  }), \"EXPOSE\"), \" 8000\\n\"), mdx(\"span\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"h2\", null, \"\\u9519\\u8BEF\\u4FE1\\u606F\"), mdx(\"p\", null, \"\\u672C\\u8EAB\", mdx(\"code\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"language-text\"\n  }), \"Running setup.py bdist_wheel for lxml: started\"), \"\\u8FD9\\u91CC\\u5C31\\u4F1A\\u505C\\u5F88\\u4E45\\uFF0C\\u4E4B\\u524D\\u5728\\u6811\\u8393\\u6D3E\\u4E0A\\u4E5F\\u6709\\u7C7B\\u4F3C\\u60C5\\u51B5\\u3002\"), mdx(\"p\", null, \"\\u5185\\u5BB9\\u548C\\u8FD9\\u4E2A\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://stackoverflow.com/questions/34825789/install-lxml-on-centos-7-error-command-gcc-failed-with-exit-status-4\"\n  }), \"stackoverflow\\u7684\\u95EE\\u9898\"), \"\\u4E00\\u6837\"), mdx(\"p\", null, mdx(\"code\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"language-text\"\n  }), \"'gcc' failed with exit status 4\")), mdx(\"p\", null, \"\\u5177\\u4F53\\u5982\\u4E0B\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"text\"\n  }, mdx(\"pre\", _extends({\n    parentName: \"div\"\n  }, {\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-text line-numbers\"\n  }), mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-text\"\n  }), \"  \\xB7\\xB7\\xB7\\n\\n  running build_ext\\n    building 'lxml.etree' extension\\n    creating build/temp.linux-x86_64-3.7\\n    creating build/temp.linux-x86_64-3.7/src\\n    creating build/temp.linux-x86_64-3.7/src/lxml\\n    gcc -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -DTHREAD_STACK_SIZE=0x100000 -fPIC -DCYTHON_CLINE_IN_TRACEBACK=0 -I/usr/include/libxml2 -Isrc -Isrc/lxml/includes -I/usr/local/include/python3.7m -c src/lxml/etree.c -o build/temp.linux-x86_64-3.7/src/lxml/etree.o -w\\n    gcc: internal compiler error: Killed (program cc1)\\n    Please submit a full bug report,\\n    with preprocessed source if appropriate.\\n    See <http://gcc.gnu.org/bugs.html> for instructions.\\n    Compile failed: command 'gcc' failed with exit status 4\\n    cc -I/usr/include/libxml2 -I/usr/include/libxml2 -c /tmp/xmlXPathInitvuz17qeg.c -o tmp/xmlXPathInitvuz17qeg.o\\n    /tmp/xmlXPathInitvuz17qeg.c:2:1: warning: return type defaults to 'int' [-Wimplicit-int]\\n     main (int argc, char **argv) {\\n     ^~~~\\n    cc tmp/xmlXPathInitvuz17qeg.o -L/usr/lib -lxml2 -o a.out\\n    error: command 'gcc' failed with exit status 4\\n    \\n    ----------------------------------------\\nCommand \\\"/usr/local/bin/python -u -c \\\"import setuptools, tokenize;__file__='/tmp/pip-install-9plrs64w/lxml/setup.py';f=getattr(tokenize, 'open', open)(__file__);code=f.read().replace('\\\\r\\\\n', '\\\\n');f.close();exec(compile(code, __file__, 'exec'))\\\" install --record /tmp/pip-record-ee3ss7qu/install-record.txt --single-version-externally-managed --compile\\\" failed with error code 1 in /tmp/pip-install-9plrs64w/lxml/\\nERROR: Service 'sanic' failed to build: The command '/bin/sh -c apk add --no-cache --virtual .build-deps     ca-certificates make gcc postgresql-dev linux-headers musl-dev libxslt-dev    libffi-dev jpeg-dev zlib-dev     && pip install -r requirements.txt' returned a non-zero code: 1\\n\\n\\xB7\\xB7\\xB7\\n\"), mdx(\"span\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"p\", null, \"\\u8D34\\u8FD1\\u95EE\\u9898\\u7684\\u662F\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://stackoverflow.com/a/24547445/10005510\"\n  }), \"\\u8FD9\\u4E2A\\u56DE\\u7B54\")), mdx(\"p\", null, \"\\u770B\\u4E0B\\u5185\\u5B58:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"text\"\n  }, mdx(\"pre\", _extends({\n    parentName: \"div\"\n  }, {\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-text line-numbers\"\n  }), mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-text\"\n  }), \"$ free -m\\n              total        used        free      shared  buff/cache   available\\nMem:            991         177         574          50         238         612\\nSwap:             0           0           0\"), mdx(\"span\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"p\", null, \"\\u786E\\u5B9E\\u5F88\\u5C11\\u3002\\u3002\"), mdx(\"p\", null, \"\\u65E2\\u7136\\u7269\\u7406\\u5185\\u5B58\\u4E0D\\u65B9\\u4FBF\\u589E\\u52A0\\uFF0C\\u589E\\u52A0swap\\u662F\\u8C8C\\u4F3C\\u6700\\u7B80\\u5355\\u7684\\u65B9\\u6CD5\\u4E86\\u3002\\u5177\\u4F53\\u65B9\\u6CD5\\u53C2\\u8003\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.digitalocean.com/community/tutorials/how-to-add-swap-on-centos-7\"\n  }), \"digitalocean\\u7684\\u6587\\u7AE0\")), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"shell\"\n  }, mdx(\"pre\", _extends({\n    parentName: \"div\"\n  }, {\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-shell line-numbers\"\n  }), mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-shell\"\n  }), mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token function\"\n  }), \"sudo\"), \" fallocate -l 4G /swapfile  \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token comment\"\n  }), \"# \\u65B0\\u5EFAswap\\u6587\\u4EF6\"), \"\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token function\"\n  }), \"sudo\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token function\"\n  }), \"chmod\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token number\"\n  }), \"600\"), \" /swapfile \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token comment\"\n  }), \"# \\u9650\\u5236\\u6743\\u9650\"), \"\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token function\"\n  }), \"sudo\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token function\"\n  }), \"mkswap\"), \" /swapfile \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token comment\"\n  }), \"# \\u8BBE\\u7F6Eswap\"), \"\\n\", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token function\"\n  }), \"sudo\"), \" \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token function\"\n  }), \"swapon\"), \" /swapfile \", mdx(\"span\", _extends({\n    parentName: \"code\"\n  }, {\n    \"className\": \"token comment\"\n  }), \"# \\u542F\\u7528swap\")), mdx(\"span\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"p\", null, \"\\u4E4B\\u540E\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"text\"\n  }, mdx(\"pre\", _extends({\n    parentName: \"div\"\n  }, {\n    \"style\": {\n      \"counterReset\": \"linenumber NaN\"\n    },\n    \"className\": \"language-text line-numbers\"\n  }), mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-text\"\n  }), \"$ free -m\\n              total        used        free      shared  buff/cache   available\\nMem:            991         182         547          50         260         607\\nSwap:          4095           0        4095\"), mdx(\"span\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"className\": \"line-numbers-rows\",\n    \"style\": {\n      \"whiteSpace\": \"normal\",\n      \"width\": \"auto\",\n      \"left\": \"0\"\n    }\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  }), mdx(\"span\", {\n    parentName: \"span\"\n  })))), mdx(\"p\", null, \"\\u7136\\u540E\\u518D\", mdx(\"code\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"language-text\"\n  }), \"docker-compose up\"), \"\\u5C31\\u987A\\u5229\\u8DD1\\u901A\\u4E86\\u3002\"));\n}\n;\nMDXContent.isMDXComponent = true;","rawBody":"---\ntitle: Docker compose与gcc内存不足的错误\ndate: 2019-01-05 08:40:43\ntags: \n- docker\n- gcc\n- centOS\n- linux\n- python\n- lxml\n\n---\n\n解决docker-compose时pip intall lxml发生gcc内存不足的错误。\n\n\n\n记忆中python的`lxml`库安装好像一直不是很顺利，每次环境变更都要折腾不少时间。这次又再次遇到了相似的问题。\n\n经过本地`docker-compose up`测试后没有问题但是服务器pull代码运行时却出现了问题。\n\n## 环境\n\n### server\n\n**server OS** : Docker centOS7 Application\n\n#### spec\n\n| -  | - |\n| --- | --- |\n| CPU: | 1 vCore |\n| RAM: | 1024 MB |\n| Storage: | 25 GB SSD |\n\n最初只是做`proxy`用的所以选了尽可能小的，但是RAM如果1G以下docker都吃力所以姑且选了1G，没想到还是稍微遇到了问题\n\n### requirements.txt\n\n```\n# requirements.txt\n\nsanic\nsanic-cors\nrequests\nlxml\n```\n\n### Dockerfile\n\n```Dockerfile\n# Dockerfile\n\nFROM python:3.7-alpine\nADD . /app\nWORKDIR /app\nRUN apk add --no-cache --virtual .build-deps \\\n    ca-certificates make gcc postgresql-dev linux-headers musl-dev libxslt-dev\\\n    libffi-dev jpeg-dev zlib-dev \\\n    && pip install -r requirements.txt\nCMD [\"python\", \"main.py\"]\nEXPOSE 8000\n\n```\n## 错误信息\n\n本身`Running setup.py bdist_wheel for lxml: started`这里就会停很久，之前在树莓派上也有类似情况。\n\n内容和这个[stackoverflow的问题](https://stackoverflow.com/questions/34825789/install-lxml-on-centos-7-error-command-gcc-failed-with-exit-status-4)一样\n\n`'gcc' failed with exit status 4`\n\n具体如下\n\n```\n  ···\n\n  running build_ext\n    building 'lxml.etree' extension\n    creating build/temp.linux-x86_64-3.7\n    creating build/temp.linux-x86_64-3.7/src\n    creating build/temp.linux-x86_64-3.7/src/lxml\n    gcc -Wno-unused-result -Wsign-compare -DNDEBUG -g -fwrapv -O3 -Wall -DTHREAD_STACK_SIZE=0x100000 -fPIC -DCYTHON_CLINE_IN_TRACEBACK=0 -I/usr/include/libxml2 -Isrc -Isrc/lxml/includes -I/usr/local/include/python3.7m -c src/lxml/etree.c -o build/temp.linux-x86_64-3.7/src/lxml/etree.o -w\n    gcc: internal compiler error: Killed (program cc1)\n    Please submit a full bug report,\n    with preprocessed source if appropriate.\n    See <http://gcc.gnu.org/bugs.html> for instructions.\n    Compile failed: command 'gcc' failed with exit status 4\n    cc -I/usr/include/libxml2 -I/usr/include/libxml2 -c /tmp/xmlXPathInitvuz17qeg.c -o tmp/xmlXPathInitvuz17qeg.o\n    /tmp/xmlXPathInitvuz17qeg.c:2:1: warning: return type defaults to 'int' [-Wimplicit-int]\n     main (int argc, char **argv) {\n     ^~~~\n    cc tmp/xmlXPathInitvuz17qeg.o -L/usr/lib -lxml2 -o a.out\n    error: command 'gcc' failed with exit status 4\n    \n    ----------------------------------------\nCommand \"/usr/local/bin/python -u -c \"import setuptools, tokenize;__file__='/tmp/pip-install-9plrs64w/lxml/setup.py';f=getattr(tokenize, 'open', open)(__file__);code=f.read().replace('\\r\\n', '\\n');f.close();exec(compile(code, __file__, 'exec'))\" install --record /tmp/pip-record-ee3ss7qu/install-record.txt --single-version-externally-managed --compile\" failed with error code 1 in /tmp/pip-install-9plrs64w/lxml/\nERROR: Service 'sanic' failed to build: The command '/bin/sh -c apk add --no-cache --virtual .build-deps     ca-certificates make gcc postgresql-dev linux-headers musl-dev libxslt-dev    libffi-dev jpeg-dev zlib-dev     && pip install -r requirements.txt' returned a non-zero code: 1\n\n···\n\n```\n\n贴近问题的是[这个回答](https://stackoverflow.com/a/24547445/10005510)\n\n看下内存:\n\n```\n$ free -m\n              total        used        free      shared  buff/cache   available\nMem:            991         177         574          50         238         612\nSwap:             0           0           0\n```\n\n确实很少。。\n\n既然物理内存不方便增加，增加swap是貌似最简单的方法了。具体方法参考[digitalocean的文章](https://www.digitalocean.com/community/tutorials/how-to-add-swap-on-centos-7)\n\n```shell\nsudo fallocate -l 4G /swapfile  # 新建swap文件\nsudo chmod 600 /swapfile # 限制权限\nsudo mkswap /swapfile # 设置swap\nsudo swapon /swapfile # 启用swap\n```\n\n之后\n\n```\n$ free -m\n              total        used        free      shared  buff/cache   available\nMem:            991         182         547          50         260         607\nSwap:          4095           0        4095\n```\n\n然后再`docker-compose up`就顺利跑通了。\n","frontmatter":{"title":"Docker compose与gcc内存不足的错误","date":"2019-01-05T08:40:43.000Z","tags":["docker","gcc","centOS","linux","python","lxml"]},"headings":[{"value":"环境"},{"value":"server"},{"value":"spec"},{"value":"requirements.txt"},{"value":"Dockerfile"},{"value":"错误信息"}]}},"pageContext":{"slug":"posts/docker-compose-gcc-error","prev":{"id":"a82ef19c-17dd-5858-b044-824c2c436094","frontmatter":{"title":"2018总结","date":"2019-01-06T15:58:53.000Z","tags":["日常"]},"fields":{"slug":"posts/2018-recap"}},"next":{"id":"5e5bab32-3337-59ac-8b7f-221e9c2b1704","frontmatter":{"title":"about Tumblr","date":"2018-11-26T01:07:23.000Z","tags":["日常","美术"]},"fields":{"slug":"posts/start-using-tumblr"}},"identifier":"b4495307-a546-56a6-9684-474b6f3b3666"}},"staticQueryHashes":["1132682437","3649515864","764694655"]}