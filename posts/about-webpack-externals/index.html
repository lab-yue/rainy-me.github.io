<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta name="generator" content="Gatsby 2.32.3"/><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><title data-react-helmet="true">About webpack externals | 浅色圆锥曲线爱好者</title><link data-react-helmet="true" rel="stylesheet" href="https://cdn.jsdelivr.net/gh/tonsky/FiraCode@4/distr/fira_code.css"/><link data-react-helmet="true" rel="canonical" href="https://blog.yue.coffee/posts/about-webpack-externals"/><meta data-react-helmet="true" name="description" content="blog of yue: 由于一些原因需要使用webpack交叉编译一个ts + yarn workspace的 app。web 端没有什么遇到什么问题，但是交叉编译服务器端一直报错，查阅了很多资料终于解决。 - [简单的可以运行的例子](https://github.com/rainy-me/webpack-express-ts-monor..."/><meta data-react-helmet="true" property="og:title" content="About webpack externals"/><meta data-react-helmet="true" property="og:description" content="blog of yue: 由于一些原因需要使用webpack交叉编译一个ts + yarn workspace的 app。web 端没有什么遇到什么问题，但是交叉编译服务器端一直报错，查阅了很多资料终于解决。 - [简单的可以运行的例子](https://github.com/rainy-me/webpack-express-ts-monor..."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="twitter:creator" content="yue"/><meta data-react-helmet="true" name="twitter:title" content="About webpack externals"/><meta data-react-helmet="true" name="twitter:description" content="blog of yue: 由于一些原因需要使用webpack交叉编译一个ts + yarn workspace的 app。web 端没有什么遇到什么问题，但是交叉编译服务器端一直报错，查阅了很多资料终于解决。 - [简单的可以运行的例子](https://github.com/rainy-me/webpack-express-ts-monor..."/><style data-styled="" data-styled-version="5.2.1">.NfRVw{font-size:1rem;background-color:#333;box-shadow:0 1px 3px #000;color:#fff;padding:0.5rem;}/*!sc*/
data-styled.g14[id="footer__GlobalFooter-sc-6bj9pp-0"]{content:"NfRVw,"}/*!sc*/
.jWShHr{background:#333;box-shadow:0 0 3px #000;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;-webkit-align-items:baseline;-webkit-box-align:baseline;-ms-flex-align:baseline;align-items:baseline;color:#ccc;text-align:left;font-size:1rem;padding:0.5rem;}/*!sc*/
data-styled.g15[id="header__GlobalHeader-sc-1d76vqs-0"]{content:"jWShHr,"}/*!sc*/
.hSDgvG > a{margin:0 10px;}/*!sc*/
@media screen and (max-width:700px){.hSDgvG{display:none;}}/*!sc*/
data-styled.g17[id="header__RightCorner-sc-1d76vqs-2"]{content:"hSDgvG,"}/*!sc*/
@font-face{font-family:'great-vibes-merge';unicode-range:U+0021-007A;src:url('/fonts/GreatVibes-Regular.woff2') format('woff2');}/*!sc*/
@font-face{font-family:'noto-serif-sc';src:url('/fonts/NotoSerifSC-Regular.subset.woff2') format('woff2');unicode-range:U+3000-9FFF;}/*!sc*/
*{box-sizing:border-box;-ms-overflow-style:none;-webkit-scrollbar-width:none;-moz-scrollbar-width:none;-ms-scrollbar-width:none;scrollbar-width:none;}/*!sc*/
*::selection{color:#fff;background:skyblue;}/*!sc*/
::-webkit-scrollbar{display:none;width:0px;background:transparent;}/*!sc*/
html,body{font-family:sans-serif;text-align:center;font-size:20px;color:#ffffff;margin:0;padding:0;width:100%;height:100%;background-color:#1d1d1d;}/*!sc*/
ul{margin:0;padding:0;list-style:none;}/*!sc*/
a{color:inherit;-webkit-text-decoration:none;text-decoration:none;}/*!sc*/
#___gatsby{width:100%;min-height:100%;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;}/*!sc*/
#___gatsby > div{-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:column;-ms-flex-direction:column;flex-direction:column;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;min-height:100%;}/*!sc*/
main{padding-bottom:3rem;}/*!sc*/
data-styled.g19[id="sc-global-cEbgiz1"]{content:"sc-global-cEbgiz1,"}/*!sc*/
.ctnZPS pre{background-color:#333;padding:1rem;font-size:0.9rem;overflow:scroll;text-align:left;border:0;box-shadow:0 0 10px #111;border-radius:10px;}/*!sc*/
.ctnZPS pre code{font-family:"Fira Code";background:none;text-shadow:none;}/*!sc*/
.ctnZPS pre code .keyword{color:hotpink;}/*!sc*/
.ctnZPS pre code .punctuation{color:skyblue;}/*!sc*/
.ctnZPS pre code .tag{color:hotpink;}/*!sc*/
.ctnZPS pre code .builtin{color:mediumpurple;}/*!sc*/
.ctnZPS pre code .operator{color:hotpink;}/*!sc*/
.ctnZPS pre code .function{color:#ffd54f;}/*!sc*/
.ctnZPS pre code .constant{color:mediumpurple;}/*!sc*/
.ctnZPS pre code .parameter{color:#fb8c00;}/*!sc*/
.ctnZPS pre code .string{color:yellowgreen;}/*!sc*/
.ctnZPS pre code .comment{color:#555;}/*!sc*/
.ctnZPS pre code .class-name{color:skyblue;}/*!sc*/
data-styled.g20[id="codeBlock-sc-12lvfgr-0"]{content:"ctnZPS,"}/*!sc*/
.iGRAlZ{margin:0 auto;width:80%;padding-bottom:8rem;}/*!sc*/
@media screen and (max-width:700px){.iGRAlZ{width:90%;}}/*!sc*/
data-styled.g21[id="comments__CommentBlock-sc-9weum8-0"]{content:"iGRAlZ,"}/*!sc*/
.issIJo{line-height:1.5;margin:0 auto;padding-bottom:1rem;text-align:left;max-width:1000px;word-break:break-all;width:90%;color:#ccc;font-family:"Fira Code";}/*!sc*/
.issIJo > *{max-width:100%;}/*!sc*/
.issIJo h2,.issIJo h3,.issIJo h4,.issIJo h5,.issIJo h6{margin-top:3rem;color:#eee;position:relative;}/*!sc*/
.issIJo h2::before,.issIJo h3::before,.issIJo h4::before,.issIJo h5::before,.issIJo h6::before{content:"○";position:absolute;color:#607d8b;top:0;left:-1.5rem;}/*!sc*/
.issIJo h2::before{content:"#";}/*!sc*/
.issIJo h3::before{content:"◆";}/*!sc*/
.issIJo del{color:#888;margin:0 5px;}/*!sc*/
.issIJo img{-webkit-transition:0.3s all ease-in-out;transition:0.3s all ease-in-out;display:block;margin:2rem auto;max-width:100%;object-fit:contain;opacity:0.8;}/*!sc*/
.issIJo img:hover{opacity:1;}/*!sc*/
.issIJo a{position:relative;display:inline-block;z-index:1;-webkit-transition:0.2s all ease-in-out;transition:0.2s all ease-in-out;-webkit-text-decoration:underline;text-decoration:underline;text-underline-offset:5px;-webkit-text-decoration-color:#607d8b;text-decoration-color:#607d8b;}/*!sc*/
.issIJo a::after{-webkit-transition:0.2s all ease-in-out;transition:0.2s all ease-in-out;content:" ";margin:2px 0;position:absolute;width:100%;height:0;bottom:0;background-color:transparent;left:0;z-index:-1;}/*!sc*/
.issIJo a:hover{color:#fff;text-shadow:0 0 3px #000;}/*!sc*/
.issIJo a:hover::after{height:100%;z-index:-1;background-color:#607d8b;}/*!sc*/
.issIJo ul{list-style:disc;padding-left:1rem;}/*!sc*/
.issIJo table{margin:3rem auto;border-collapse:collapse;}/*!sc*/
.issIJo table th,.issIJo table tr,.issIJo table td{padding:10px;border:3px solid #333;}/*!sc*/
.issIJo blockquote{padding:1rem;margin:1rem 0;background-color:#333;border-left:10px solid #455a64;border-top-left-radius:8px;border-bottom-left-radius:8px;box-shadow:0 0 5px #000;}/*!sc*/
.issIJo pre code::after{background:none;}/*!sc*/
.issIJo code{text-shadow:1px 1px 4px #000;color:#fff;word-break:break-word;margin:4px 4px;display:inline-block;padding:0 5px;font-family:"Fira Code";position:relative;z-index:0;}/*!sc*/
.issIJo code::after{-webkit-transition:0.2s all ease-in-out;transition:0.2s all ease-in-out;content:"";border-radius:5px;opacity:0.8;z-index:-1;width:100%;height:100%;position:absolute;top:0;left:0;background-image:linear-gradient(100deg,#ec407a 47%,#00bcd4);}/*!sc*/
.issIJo code:hover::after{opacity:1;}/*!sc*/
.issIJo iframe{width:80%;margin:0 auto;display:inherit;}/*!sc*/
@media screen and (max-width:700px){.issIJo h2::before,.issIJo h3::before,.issIJo h4::before,.issIJo h5::before,.issIJo h6::before{top:0.2rem;font-size:1rem;left:-1rem;}.issIJo iframe{max-width:100%;width:100%;}}/*!sc*/
data-styled.g22[id="markdownContent__MarkdownContentBlock-sc-1c6mo1j-0"]{content:"issIJo,"}/*!sc*/
.gGdKwU{font-size:inherit;padding:1rem;font-family:'great-vibes-merge','noto-serif-sc';-webkit-filter:drop-shadow(0 0 3px #000);filter:drop-shadow(0 0 3px #000);width:-webkit-fit-content;width:-moz-fit-content;width:fit-content;display:inline-block;font-weight:normal;text-align:center;background:linear-gradient(180deg,skyblue,#e91e63);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;}/*!sc*/
@media screen and (max-width:700px){.gGdKwU{font-size:4rem;}}/*!sc*/
data-styled.g23[id="gradientFont-sc-6873be-0"]{content:"gGdKwU,"}/*!sc*/
.cyZxmM{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;margin:4rem;-webkit-flex-wrap:wrap;-ms-flex-wrap:wrap;flex-wrap:wrap;-webkit-align-items:baseline;-webkit-box-align:baseline;-ms-flex-align:baseline;align-items:baseline;}/*!sc*/
.cyZxmM a{margin:1rem;}/*!sc*/
@media screen and (max-width:700px){.cyZxmM{margin:0;margin-bottom:3rem;}.cyZxmM a{margin:1rem 5px;}}/*!sc*/
data-styled.g53[id="pagination__PaginationNav-sc-1nud1ku-0"]{content:"cyZxmM,"}/*!sc*/
.iENrYe{-webkit-transition:0.5s all cubic-bezier(0.4,0,0.2,1);transition:0.5s all cubic-bezier(0.4,0,0.2,1);box-shadow:#0 0 5px #000;background:#333;color:none;border-radius:5px;padding:0.5rem;background-size:200%,150%;}/*!sc*/
.iENrYe:hover{background-color:#e91e63;}/*!sc*/
data-styled.g54[id="pagination__PaginationLink-sc-1nud1ku-1"]{content:"iENrYe,"}/*!sc*/
.kUfmsL{font-size:4rem;word-break:break-word;margin-bottom:1rem;}/*!sc*/
@media screen and (max-width:700px){.kUfmsL{font-size:4rem;}}/*!sc*/
data-styled.g58[id="post__PostTitle-sc-1xlzpqm-0"]{content:"kUfmsL,"}/*!sc*/
.entpDK{font-size:1.5rem;color:#666;margin-bottom:2rem;display:inline-block;text-shadow:0 0 1rem #000;}/*!sc*/
data-styled.g59[id="post__PostDate-sc-1xlzpqm-1"]{content:"entpDK,"}/*!sc*/
</style><link rel="icon" href="/favicon-32x32.png?v=9cddaf2e6e675db0946c978328f41acf" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#333333"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=9cddaf2e6e675db0946c978328f41acf"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=9cddaf2e6e675db0946c978328f41acf"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=9cddaf2e6e675db0946c978328f41acf"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=9cddaf2e6e675db0946c978328f41acf"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=9cddaf2e6e675db0946c978328f41acf"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=9cddaf2e6e675db0946c978328f41acf"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=9cddaf2e6e675db0946c978328f41acf"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=9cddaf2e6e675db0946c978328f41acf"/><link as="script" rel="preload" href="/webpack-runtime-7c8fc6a8f480e9e53114.js"/><link as="script" rel="preload" href="/framework-7bbb7991de2c9dccc6ce.js"/><link as="script" rel="preload" href="/app-6449b067c612e0695477.js"/><link as="script" rel="preload" href="/2c282eaea363d2bbd23f6fd873d3621ed8cccc49-62c08aac037425a564a3.js"/><link as="script" rel="preload" href="/2595aca8b7d3d21cc09d2fd82059f82ae42ef8db-6504ffc2139a13510264.js"/><link as="script" rel="preload" href="/component---src-templates-post-index-tsx-c5fba1cdc8dd9b37f87d.js"/><link as="fetch" rel="preload" href="/page-data/posts/about-webpack-externals/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/1132682437.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3649515864.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/764694655.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><header class="header__GlobalHeader-sc-1d76vqs-0 jWShHr"><span class="header__LeftCorner-sc-1d76vqs-1 hlA-dLO"><a href="/">浅色圆锥曲线爱好者</a></span><span class="header__RightCorner-sc-1d76vqs-2 hSDgvG"><a href="/posts">Posts</a><a href="/notes">Notes</a><a href="/aboutme">About</a></span></header><main style="opacity:0"><div><h1 class="post__PostTitle-sc-1xlzpqm-0 kUfmsL"><span class="gradientFont-sc-6873be-0 gGdKwU">About webpack externals</span></h1><time class="post__PostDate-sc-1xlzpqm-1 entpDK">2020-04-01</time><article class="codeBlock-sc-12lvfgr-0 markdownContent__MarkdownContentBlock-sc-1c6mo1j-0 ctnZPS issIJo"><p>由于一些原因需要使用<code class="language-text">webpack</code>交叉编译一个<code class="language-text">ts</code> + <code class="language-text">yarn workspace</code>的 app。web 端没有什么遇到什么问题，但是交叉编译服务器端一直报错，查阅了很多资料终于解决。</p><ul><li><a href="https://github.com/rainy-me/webpack-express-ts-monorepo">简单的可以运行的例子</a></li></ul><p>项目构成</p><div class="gatsby-highlight" data-language="text"><pre style="counter-reset:linenumber NaN" class="language-text line-numbers"><code class="language-text">.
├── package.json
├── packages
│   ├── script
│   │   ├── package.json
│   │   ├── server.ts
│   │   ├── tsconfig.webpack.json
│   │   └── webpack.server.ts
│   └── server
│       ├── index.ts
│       └── package.json
├── tsconfig.json
└── yarn.lock

3 directories, 9 files</code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div><p>简单的 server.ts</p><div class="gatsby-highlight" data-language="ts"><pre style="counter-reset:linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">import</span> express <span class="token keyword">from</span> <span class="token string">&quot;express&quot;</span>

<span class="token keyword">const</span> <span class="token function-variable function">startServer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  app<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>_<span class="token punctuation">,</span> res<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;ok&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;listening on 3000&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> startServer</code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div><p>最开始的 <code class="language-text">webpack.server.ts</code>长这个样子。没什么特别的</p><div class="gatsby-highlight" data-language="ts"><pre style="counter-reset:linenumber NaN" class="language-ts line-numbers"><code class="language-ts"><span class="token keyword">import</span> path <span class="token keyword">from</span> <span class="token string">&quot;path&quot;</span>
<span class="token keyword">import</span> webpack<span class="token punctuation">,</span> <span class="token punctuation">{</span> Configuration <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;webpack&quot;</span>
<span class="token keyword">const</span> serverSrc <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./server.ts&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> distRoot <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;./dist&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> serverConfig<span class="token operator">:</span> Configuration <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">&quot;production&quot;</span><span class="token punctuation">,</span>
  target<span class="token operator">:</span> <span class="token string">&quot;node&quot;</span><span class="token punctuation">,</span>
  node<span class="token operator">:</span> <span class="token punctuation">{</span>
    __dirname<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    __filename<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  entry<span class="token operator">:</span> <span class="token punctuation">{</span>
    server<span class="token operator">:</span> serverSrc<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path<span class="token operator">:</span> distRoot<span class="token punctuation">,</span>
    filename<span class="token operator">:</span> <span class="token string">&quot;server.js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  resolve<span class="token operator">:</span> <span class="token punctuation">{</span> extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;.js&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.ts&quot;</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack</span><span class="token punctuation">.</span><span class="token function">DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token string">&quot;process.env&quot;</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack</span><span class="token punctuation">.</span><span class="token function">ProgressPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token keyword">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.ts$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        loader<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">&quot;ts-loader&quot;</span><span class="token punctuation">,</span>
            options<span class="token operator">:</span> <span class="token punctuation">{</span>
              transpileOnly<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> serverConfig</code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div><p>运行得到以下错误</p><div class="gatsby-highlight" data-language="log"><pre style="counter-reset:linenumber NaN" class="language-log line-numbers"><code class="language-log">WARNING in /home/yue/projects/webpack-express-ts-monorepo/node_modules/express/lib/view.js 81:13-25
Critical dependency: the request of a dependency is an expression
 @ /home/yue/projects/webpack-express-ts-monorepo/node_modules/express/lib/application.js
 @ /home/yue/projects/webpack-express-ts-monorepo/node_modules/express/lib/express.js
 @ /home/yue/projects/webpack-express-ts-monorepo/node_modules/express/index.js
 @ /home/yue/projects/webpack-express-ts-monorepo/node_modules/@package/server/index.ts
 @ ./server.ts

ERROR in server.js from Terser
Unexpected token: punc (:) [server.js:8974,12]
error Command failed with exit code 2.</code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div><p>经过查询，最常见的方法是使用 <code class="language-text">webpack-node-externals</code>这个库将部分不适合 bundle 的库除外。于是进行修改</p><div class="gatsby-highlight" data-language="diff"><pre style="counter-reset:linenumber NaN" class="language-diff line-numbers"><code class="language-diff"><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>  externals: [nodeExternals()],</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span></span></pre></div><p>再度编译还是得到相同错误。</p><div class="gatsby-highlight" data-language="text"><pre style="counter-reset:linenumber NaN" class="language-text line-numbers"><code class="language-text">ERROR in server.js from Terser
Unexpected token: punc (:) [server.js:8974,12]</code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span></span></pre></div><p>再度查阅资料在这个问题里有提到<code class="language-text">yarn workspace</code>需要做不同的处理，遇上按照<a href="https://stackoverflow.com/a/53453054">这个回答</a>再度修改，将根目录的<code class="language-text">node_modules</code>也加入 exclude 对象。</p><div class="gatsby-highlight" data-language="diff"><pre style="counter-reset:linenumber NaN" class="language-diff line-numbers"><code class="language-diff"><span class="token deleted-sign deleted"><span class="token prefix deleted">-</span>  externals: [nodeExternals()],
</span><span class="token inserted-sign inserted"><span class="token prefix inserted">+</span>  externals: [
<span class="token prefix inserted">+</span>    nodeExternals(),
<span class="token prefix inserted">+</span>    nodeExternals({
<span class="token prefix inserted">+</span>      modulesDir: path.resolve(__dirname, &#x27;../../node_modules&#x27;),
<span class="token prefix inserted">+</span>    }),
<span class="token prefix inserted">+</span>  ],</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div><p><code class="language-text">yarn build</code> 得到以下结果</p><div class="gatsby-highlight" data-language="log"><pre style="counter-reset:linenumber NaN" class="language-log line-numbers"><code class="language-log">yarn run v1.22.4
$ yarn workspace @package/script build
warning package.json: No license field
$ TS_NODE_PROJECT=./tsconfig.webpack.json webpack --config webpack.server.ts
Hash: 571930a4d43752f5eb7a
Version: webpack 4.42.1
Time: 163ms
Built at: 04/01/2020 11:47:55 PM
    Asset      Size  Chunks             Chunk Names
server.js  1.12 KiB       0  [emitted]  server
Entrypoint server = server.js
[0] ./server.ts 296 bytes {0} [built]
[1] external &quot;@package/server&quot; 42 bytes {0} [built]
Done in 3.23s.</code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div><p>交叉编译成功了诶！可以洗洗睡了！睡前<code class="language-text">yarn start</code>运行一下交叉编译成果吧。</p><div class="gatsby-highlight" data-language="log"><pre style="counter-reset:linenumber NaN" class="language-log line-numbers"><code class="language-log">yarn run v1.22.4
$ yarn workspace @package/script start
warning package.json: No license field
$ node ./dist/server.js
/home/yue/projects/webpack-express-ts-monorepo/packages/server/index.ts:1
import express from &quot;express&quot;;
^^^^^^

SyntaxError: Cannot use import statement outside a module
    at wrapSafe (internal/modules/cjs/loader.js:1063:16)
    at Module._compile (internal/modules/cjs/loader.js:1111:27)
    at Object.Module._extensions..js (internal/modules/cjs/loader.js:1167:10)
    at Module.load (internal/modules/cjs/loader.js:996:32)
    at Function.Module._load (internal/modules/cjs/loader.js:896:14)
    at Module.require (internal/modules/cjs/loader.js:1036:19)
    at require (internal/modules/cjs/helpers.js:72:18)
    at Object.&lt;anonymous&gt; (/home/yue/projects/webpack-express-ts-monorepo/packages/script/dist/server.js:1:1118)
    at r (/home/yue/projects/webpack-express-ts-monorepo/packages/script/dist/server.js:1:110)
    at Object.&lt;anonymous&gt; (/home/yue/projects/webpack-express-ts-monorepo/packages/script/dist/server.js:1:1077)
error Command failed with exit code 1.
info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.
error Command failed.
Exit code: 1
Command: /usr/bin/node
Arguments: /usr/lib/node_modules/yarn/lib/cli.js start
Directory: /home/yue/projects/webpack-express-ts-monorepo/packages/script
Output:

info Visit https://yarnpkg.com/en/docs/cli/workspace for documentation about this command.
error Command failed with exit code 1.
info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.</code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div><p>什么，<code class="language-text">packages/server</code>根本没有被交叉编译！！？？</p><p>看一眼交叉编译出来的文件：</p><div class="gatsby-highlight" data-language="js"><pre style="counter-reset:linenumber NaN" class="language-js line-numbers"><code class="language-js"><span class="token operator">!</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> t<span class="token operator">=</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">r</span><span class="token punctuation">(</span><span class="token parameter">n</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>t<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">return</span> t<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">.</span>exports<span class="token punctuation">;</span><span class="token keyword">var</span> o<span class="token operator">=</span>t<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">{</span>i<span class="token operator">:</span>n<span class="token punctuation">,</span>l<span class="token operator">:</span><span class="token operator">!</span><span class="token number">1</span><span class="token punctuation">,</span>exports<span class="token operator">:</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">return</span> e<span class="token punctuation">[</span>n<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>o<span class="token punctuation">.</span>exports<span class="token punctuation">,</span>o<span class="token punctuation">,</span>o<span class="token punctuation">.</span>exports<span class="token punctuation">,</span>r<span class="token punctuation">)</span><span class="token punctuation">,</span>o<span class="token punctuation">.</span>l<span class="token operator">=</span><span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">,</span>o<span class="token punctuation">.</span>exports<span class="token punctuation">}</span>r<span class="token punctuation">.</span>m<span class="token operator">=</span>e<span class="token punctuation">,</span>r<span class="token punctuation">.</span>c<span class="token operator">=</span>t<span class="token punctuation">,</span>r<span class="token punctuation">.</span><span class="token function-variable function">d</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span>t<span class="token punctuation">,</span>n</span><span class="token punctuation">)</span><span class="token punctuation">{</span>r<span class="token punctuation">.</span><span class="token function">o</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token operator">||</span>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span>t<span class="token punctuation">,</span><span class="token punctuation">{</span>enumerable<span class="token operator">:</span><span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">,</span>get<span class="token operator">:</span>n<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>r<span class="token punctuation">.</span><span class="token function-variable function">r</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token string">&quot;undefined&quot;</span><span class="token operator">!=</span><span class="token keyword">typeof</span> Symbol<span class="token operator">&amp;&amp;</span>Symbol<span class="token punctuation">.</span>toStringTag<span class="token operator">&amp;&amp;</span>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span>Symbol<span class="token punctuation">.</span>toStringTag<span class="token punctuation">,</span><span class="token punctuation">{</span>value<span class="token operator">:</span><span class="token string">&quot;Module&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span><span class="token string">&quot;__esModule&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>value<span class="token operator">:</span><span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>r<span class="token punctuation">.</span><span class="token function-variable function">t</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span>t</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">&amp;</span>t<span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span>e<span class="token operator">=</span><span class="token function">r</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token operator">&amp;</span>t<span class="token punctuation">)</span><span class="token keyword">return</span> e<span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token operator">&amp;</span>t<span class="token operator">&amp;&amp;</span><span class="token string">&quot;object&quot;</span><span class="token operator">==</span><span class="token keyword">typeof</span> e<span class="token operator">&amp;&amp;</span>e<span class="token operator">&amp;&amp;</span>e<span class="token punctuation">.</span>__esModule<span class="token punctuation">)</span><span class="token keyword">return</span> e<span class="token punctuation">;</span><span class="token keyword">var</span> n<span class="token operator">=</span>Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span><span class="token function">r</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">,</span>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span><span class="token string">&quot;default&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>enumerable<span class="token operator">:</span><span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">,</span>value<span class="token operator">:</span>e<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token operator">&amp;</span>t<span class="token operator">&amp;&amp;</span><span class="token string">&quot;string&quot;</span><span class="token operator">!=</span><span class="token keyword">typeof</span> e<span class="token punctuation">)</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> o <span class="token keyword">in</span> e<span class="token punctuation">)</span>r<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span>o<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">t</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> e<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span>o<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span> n<span class="token punctuation">}</span><span class="token punctuation">,</span>r<span class="token punctuation">.</span><span class="token function-variable function">n</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> t<span class="token operator">=</span>e<span class="token operator">&amp;&amp;</span>e<span class="token punctuation">.</span>__esModule<span class="token operator">?</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> e<span class="token punctuation">.</span>default<span class="token punctuation">}</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> e<span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token keyword">return</span> r<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token punctuation">,</span>t<span class="token punctuation">}</span><span class="token punctuation">,</span>r<span class="token punctuation">.</span><span class="token function-variable function">o</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span>t</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">hasOwnProperty</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span>t<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>r<span class="token punctuation">.</span>p<span class="token operator">=</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token function">r</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>s<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span>t<span class="token punctuation">,</span>r</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token string">&quot;use strict&quot;</span><span class="token punctuation">;</span><span class="token keyword">var</span> n<span class="token operator">=</span><span class="token keyword">this</span><span class="token operator">&amp;&amp;</span><span class="token keyword">this</span><span class="token punctuation">.</span>__importDefault<span class="token operator">||</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> e<span class="token operator">&amp;&amp;</span>e<span class="token punctuation">.</span>__esModule<span class="token operator">?</span>e<span class="token operator">:</span><span class="token punctuation">{</span><span class="token keyword">default</span><span class="token operator">:</span>e<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span><span class="token string">&quot;__esModule&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>value<span class="token operator">:</span><span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">n</span><span class="token punctuation">(</span><span class="token function">r</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">default</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e<span class="token punctuation">,</span>t</span><span class="token punctuation">)</span><span class="token punctuation">{</span>e<span class="token punctuation">.</span>exports<span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@package/server&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span></span></pre></div><p><code class="language-text">require(&quot;@package/server&quot;)</code>是个什么鬼嘛 (╯°□°）╯︵ ┻━┻</p><p>再度回到刚才那个 stackoverflow 的问题。仔细查看之后得出以下结论</p><ul><li>我们需要交叉编译所有自己写的 ts 文件</li><li>我们没理由交叉编译所有第三方库</li></ul><p>于是查阅 webpack 的<a href="https://webpack.js.org/configuration/externals/#function">官方文档</a>再再次出做修改</p><div class="gatsby-highlight" data-language="ts"><pre style="counter-reset:linenumber NaN" class="language-ts line-numbers"><code class="language-ts">  externals<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">(</span>_<span class="token punctuation">,</span> req<span class="token punctuation">,</span> cb<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^@package</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> req<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string">&quot;.&quot;</span> <span class="token operator">&amp;&amp;</span> req<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">commonjs </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>req<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span></code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div><p>当一个 import path 是本地的 package(<code class="language-text">@package</code>开头)，相对路径(<code class="language-text">&quot;.&quot;</code>开头), 绝对路径(<code class="language-text">&quot;/&quot;</code>开头)时进行交叉编译，不是的时候直接使用原来的<code class="language-text">commonjs</code>模块。</p><p>再度编译结果正常。</p><div class="gatsby-highlight" data-language="log"><pre style="counter-reset:linenumber NaN" class="language-log line-numbers"><code class="language-log">yarn run v1.22.4
$ yarn workspace @package/script build
warning package.json: No license field
$ TS_NODE_PROJECT=./tsconfig.webpack.json webpack --config webpack.server.ts
Hash: f0adf7b87e9622543054
Version: webpack 4.42.1
Time: 176ms
Built at: 04/02/2020 12:02:19 AM
    Asset      Size  Chunks             Chunk Names
server.js  1.42 KiB       0  [emitted]  server
Entrypoint server = server.js
[0] ./server.ts 296 bytes {0} [built]
[2] external &quot;express&quot; 42 bytes {0} [built]
    + 1 hidden module
Done in 3.22s.</code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></pre></div><p>尝试运行<code class="language-text">yarn start</code></p><div class="gatsby-highlight" data-language="log"><pre style="counter-reset:linenumber NaN" class="language-log line-numbers"><code class="language-log">yarn run v1.22.4
$ yarn workspace @package/script start
warning package.json: No license field
$ node ./dist/server.js
listening on 3000</code><span aria-hidden="true" class="line-numbers-rows" style="white-space:normal;width:auto;left:0"><span></span><span></span><span></span><span></span><span></span></span></pre></div><p>到此为止解决了问题 💞</p></article></div><nav class="pagination__PaginationNav-sc-1nud1ku-0 cyZxmM"><a href="/posts/measure-and-optimize-using-usecallback-usememo-and-memo"><span class="pagination__PaginationLink-sc-1nud1ku-1 iENrYe">&lt; 「测试并优化」useCallback, useMemo 与 React.memo</span></a><a href="/posts/kusatsu-onsen-trip"><span class="pagination__PaginationLink-sc-1nud1ku-1 iENrYe">雪与温泉的草津旅行 &gt;</span></a></nav><div class="comments__CommentBlock-sc-9weum8-0 iGRAlZ"><div shortname="yue-blog" config="[object Object]" id="disqus_thread"></div></div></main></div><footer class="footer__GlobalFooter-sc-6bj9pp-0 NfRVw">© <!-- -->2021</footer></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/posts/about-webpack-externals";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-2ffdf0a31820fc928c1c.js"],"app":["/app-6449b067c612e0695477.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-47c8d8b7529f7a984452.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-40668c83a594549f10d6.js"],"component---src-pages-aboutme-tsx":["/component---src-pages-aboutme-tsx-27982e3f40e0bd53cac2.js"],"component---src-pages-index-tsx":["/component---src-pages-index-tsx-cc088881bbd1358fb0fb.js"],"component---src-pages-ogp-tsx":["/component---src-pages-ogp-tsx-aea11a3cf5dc1a67f1e4.js"],"component---src-templates-note-archive-tsx":["/component---src-templates-note-archive-tsx-3686b55d51763c598ab8.js"],"component---src-templates-note-index-tsx":["/component---src-templates-note-index-tsx-700599f5ee1dcddaa7d5.js"],"component---src-templates-post-archive-tsx":["/component---src-templates-post-archive-tsx-55bf7d32f89e4363fcb1.js"],"component---src-templates-post-index-tsx":["/component---src-templates-post-index-tsx-c5fba1cdc8dd9b37f87d.js"]};/*]]>*/</script><script src="/polyfill-2ffdf0a31820fc928c1c.js" nomodule=""></script><script src="/component---src-templates-post-index-tsx-c5fba1cdc8dd9b37f87d.js" async=""></script><script src="/2595aca8b7d3d21cc09d2fd82059f82ae42ef8db-6504ffc2139a13510264.js" async=""></script><script src="/2c282eaea363d2bbd23f6fd873d3621ed8cccc49-62c08aac037425a564a3.js" async=""></script><script src="/app-6449b067c612e0695477.js" async=""></script><script src="/framework-7bbb7991de2c9dccc6ce.js" async=""></script><script src="/webpack-runtime-7c8fc6a8f480e9e53114.js" async=""></script></body></html>